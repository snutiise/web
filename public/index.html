<head>
    <meta charset="utf-8">
    <title>크롤링 통계</title>
    <link rel="stylesheet" href="nwagon/Nwagon.css" type="text/css">
    <script src="nwagon/Nwagon.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
</head>
<body>
    <h2 align="center">크롤링 된 데이터</h2>
    <div id="Nwagon"></div>
    <script>
        var time=0;
        if(navigator.userAgent.indexOf("Firefox") != -1) time=32400000;
        var flag=0;
        function getData(gte, lt, i){
            $.ajax({    
                type : "POST",
                url : "/count",
                data : {'gte':gte-time, 'lt':lt-time},
                success : function(data){
                    cnt[i]=Number(data);
                    flag++;
                    if(flag==31) drawChart();
                },
                error : function(){
                    alert('Server Error!');
                }
            });
        }
        function getKeyword(gte, lt){
            $.ajax({    
                type : "POST",
                url : "/keyword",
                data : {'gte':gte-time, 'lt':lt-time},
                success : function(data){
                    alert(data);
                },
                error : function(){
                    alert('Server Error!');
                }
            });
        }

        var w=screen.width-50;
        var h=screen.height-50;
        var dt = new Array(31);
        var day = new Array(31);
        var cnt = new Array(31);
        var tmp = new Date();
        var t = new Date(tmp.getFullYear()+"-"+(tmp.getMonth()+1)+"-"+tmp.getDate());
        for(i=0;i<31;i++){
            dt[i]=new Date(t.getTime()-86400000*i);
            day[i]=(dt[i].getMonth()+1)+"-"+dt[i].getDate();
            if(i==0){
                getKeyword(dt[i].getTime(),Date.now()+time);
                getData(dt[i].getTime(),Date.now()+time,i);
            }
            else
                getData(dt[i].getTime(),dt[i-1].getTime(),i);
        }
        function drawChart(){
            var options = {
                'legend': {
                    names: day.reverse()
                },
                'dataset': {
                    title: '크롤링 된 데이터',
                    values: cnt.reverse(),
                    colorset: ['#DC143C', '#FF8C00', "#30a1ce"]
                },
                'chartDiv': 'Nwagon',
                'chartType': 'column',
                'chartSize': { width: w, height: h },
                'increment': 5000
            };
            Nwagon.chart(options);
        }
    </script>
</body>